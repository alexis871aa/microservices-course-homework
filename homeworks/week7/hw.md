# üß± –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ ‚Äî –ù–µ–¥–µ–ª—è 7
**–ö—É—Ä—Å: ¬´–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã, –∫–∞–∫ –≤ BigTech 2.0¬ª**

---

## üìå –ó–∞–¥–∞–Ω–∏–µ

–ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ –≤—ã:

1. –ù–∞—Å—Ç—Ä–æ–∏—Ç–µ Envoy –∫–∞–∫ –≤—Ö–æ–¥–Ω—É—é —Ç–æ—á–∫—É –≤ —Å–∏—Å—Ç–µ–º—É —Å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–µ–π –∏ –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å–µ—Å—Å–∏–∏.
2. –†–µ–∞–ª–∏–∑—É–µ—Ç–µ –Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å ‚Äî `NotificationService`, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –∏–∑ Kafka –∏ —É–≤–µ–¥–æ–º–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ Telegram.

---

### ‚úÖ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

#### üî∏ 1. Envoy Gateway

- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å **Envoy Proxy** –∫–∞–∫ –≤–Ω–µ—à–Ω–∏–π —à–ª—é–∑ –∫ —Å–µ—Ä–≤–∏—Å–∞–º.
- –ü—Ä–æ–ø–∏—Å–∞—Ç—å **HTTP-–º–∞—Ä—à—Ä—É—Ç—ã** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/order`, `/auth`, `/payment` –∏ —Ç.–¥.)
- –î–æ–±–∞–≤–∏—Ç—å **–ø—Ä–æ–≤–µ—Ä–∫—É —Å–µ—Å—Å–∏–∏**:
    - –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã, –∫—Ä–æ–º–µ –ø—É–±–ª–∏—á–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, `Register`, `Login`), –¥–æ–ª–∂–Ω—ã –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ `AuthService.Whoami`.
    - –ï—Å–ª–∏ —Å–µ—Å—Å–∏—è –Ω–µ–≤–∞–ª–∏–¥–Ω–∞ ‚Äî –≤–µ—Ä–Ω—É—Ç—å 401.
    - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å —á–µ—Ä–µ–∑ **Lua-—Å–∫—Ä–∏–ø—Ç**, **ext_authz** –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä.

#### üî∏ 2. NotificationService

–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å `NotificationService` —Å –ø–æ–ª–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π:
- `cmd/`, `internal/`, `config`, `service`, `di`, `client`, `consumer`

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ –Ω—ë–º:

‚úÖ Kafka Consumer:

- –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Ç–æ–ø–∏–∫–∏ `OrderPaid` –∏ `ShipAssembled`.
- –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã —Å–æ–±—ã—Ç–∏–π –æ–ø–∏—Å–∞–Ω—ã –≤:
    - [`contracts/order_service_contracts.md`](contracts/order_service_contracts.md)
    - [`contracts/assembly_service_contracts.md`](contracts/assembly_service_contracts.md)

‚úÖ –ó–∞–ø—Ä–æ—Å –≤ AuthService:

- –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–±—ã—Ç–∏—è ‚Äî –≤—ã–∑–≤–∞—Ç—å `GetUser` (gRPC) —É `AuthService`.
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª–µ `notification_methods`.

‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram:

- –ï—Å–ª–∏ —Å—Ä–µ–¥–∏ –º–µ—Ç–æ–¥–æ–≤ –µ—Å—Ç—å `telegram`, –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ Telegram-–±–æ—Ç–∞.

---

## üß± –¢—Ä–µ–±—É–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (NotificationService)

```
/notification/
‚îú‚îÄ‚îÄ go.mod
‚îú‚îÄ‚îÄ .env
‚îú‚îÄ‚îÄ /cmd/
‚îÇ   ‚îî‚îÄ‚îÄ main.go                          # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∑–∞–≥—Ä—É–∑–∫–∞ DI –∏ –∑–∞–ø—É—Å–∫
‚îú‚îÄ‚îÄ /internal/
‚îÇ   ‚îú‚îÄ‚îÄ api/                             # –ü–æ–∫–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.go                    # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ env/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ env_config.go           # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ di/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app.go                       # Bootstrap, graceful shutdown
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ service_provider.go         # –°–∞–º–æ–ø–∏—Å–Ω—ã–π DI-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ client/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ grpc/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ client.go               # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã gRPC-–∫–ª–∏–µ–Ω—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth_service/           # gRPC-–∫–ª–∏–µ–Ω—Ç AuthService
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ http/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ client.go               # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã HTTP-–∫–ª–∏–µ–Ω—Ç–æ–≤
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ telegram/               # –ö–ª–∏–µ–Ω—Ç Telegram API
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ telegram.go
‚îÇ   ‚îú‚îÄ‚îÄ service/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ service.go                  # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å NotificationService
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ notify/                     # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è NotificationService
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ service.go              # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ consumer/                   # Kafka-–∫–æ–Ω—Å—å—é–º–µ—Ä—ã
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ order_paid/             # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è OrderPaid
‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ consumer.go
‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ handler.go
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ ship_assembled/         # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è ShipAssembled
‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ consumer.go
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ handler.go

```

---

## ‚úÖ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### Envoy:

- –†–∞–∑–º–µ—Å—Ç–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥ `envoy.yaml` –≤ –∫–æ—Ä–Ω–µ –∏–ª–∏ –≤ `/infra/envoy/`
- –ü—Ä–∏–º–µ—Ä –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏:
  ```yaml
  - match:
      prefix: /order
    route:
      cluster: order_service
  ```

- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏:
    - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å ext_authz –∏–ª–∏ –Ω–∞–ø–∏—Å–∞—Ç—å Lua-—Ñ–∏–ª—å—Ç—Ä, –∫–æ—Ç–æ—Ä—ã–π –¥–µ–ª–∞–µ—Ç gRPC/HTTP-–∑–∞–ø—Ä–æ—Å –≤ `AuthService.Whoami`
    - –ü—Ä–∏–º–µ—Ä –≤ —É—Ä–æ–∫–∞—Ö –Ω–µ–¥–µ–ª–∏

### Kafka Consumer:

- –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Kafka —á–µ—Ä–µ–∑ `platform/kafka`
- –û–¥–∏–Ω Consumer ‚Äî –æ–¥–Ω–æ —Å–æ–±—ã—Ç–∏–µ
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∂–¥–æ–≥–æ —Å–æ–±—ã—Ç–∏—è:
    - –û–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ `AuthService.GetUser`
    - –†–∞—Å–ø–∞—Ä—Å–∏—Ç—å —Å–ø–∏—Å–æ–∫ `notification_methods`
    - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–∞–Ω–∞–ª—ã (–Ω–∞—á–∏–Ω–∞—è —Å Telegram)

### Telegram:

- –ú–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ HTTP-–∑–∞–ø—Ä–æ—Å –∫ Telegram Bot API
- –û–ø–∏—Å–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ ‚Äî –≤ `target` –ø–æ–ª—è `NotificationMethod`

---

## üí° –ü–æ–ª–µ–∑–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏

- **–°–Ω–∞—á–∞–ª–∞ –∏–∑—É—á–∏—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã —Å–µ–¥—å–º–æ–π –Ω–µ–¥–µ–ª–∏**:  
  –í —É—Ä–æ–∫–∞—Ö —Å–µ–¥—å–º–æ–π –Ω–µ–¥–µ–ª–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥—É—Ç –≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞–Ω–∏—è.  
  üëâ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–Ω–∞—á–∞–ª–∞ –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å —É—Ä–æ–∫–∞–º–∏, –∞ –∑–∞—Ç–µ–º –ø—Ä–∏—Å—Ç—É–ø–∞—Ç—å –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

- **–ù–µ —Å—Ç–µ—Å–Ω—è–π—Ç–µ—Å—å –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∑–∞ –ø–æ–º–æ—â—å—é**:  
  –ï—Å–ª–∏ –≤—ã —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å —Å —Ç—Ä—É–¥–Ω–æ—Å—Ç—è–º–∏ –∏–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã, –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –≤ —á–∞—Ç –∫—É—Ä—Å–∞ –∏–ª–∏ –∫ —Å–≤–æ–µ–º—É —Ä–µ–≤—å—é–µ—Ä—É (–µ—Å–ª–∏ –≤—ã –Ω–∞ —Ç–∞—Ä–∏—Ñ–µ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π).
  > –ï—Å–ª–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ 30 –º–∏–Ω—É—Ç –≤—ã –Ω–µ –º–æ–∂–µ—Ç–µ —Ä–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É, –ª—É—á—à–µ –ø–æ–ø—Ä–æ—Å–∏—Ç—å –ø–æ–º–æ—â–∏.  
  > **–°–ø—Ä–æ—Å–∏—Ç—å ‚Äî –Ω–µ –∑–Ω–∞—á–∏—Ç —Å–¥–∞—Ç—å—Å—è**, —ç—Ç–æ —É—Å–∫–æ—Ä—è–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è –±–ª–∞–≥–æ–¥–∞—Ä—è –æ–ø—ã—Ç—É –¥—Ä—É–≥–∏—Ö.

---

**–ê–≤—Ç–æ—Ä –∫—É—Ä—Å–∞: –û–ª–µ–≥ –ö–æ–∑—ã—Ä–µ–≤, 2025**
