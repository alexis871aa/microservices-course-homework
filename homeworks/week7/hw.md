# üß± –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ ‚Äî –ù–µ–¥–µ–ª—è 7
**–ö—É—Ä—Å: ¬´–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã, –∫–∞–∫ –≤ BigTech 2.0¬ª**

---

## üìå –ó–∞–¥–∞–Ω–∏–µ

–ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (Zap + OpenTelemetry Collector ‚Üí Elasticsearch + Kibana), –∞ —Ç–∞–∫–∂–µ –¥–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç—Ä–∏–∫–∏ (Prometheus + Grafana) –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π —Ç—Ä–µ–π—Å–∏–Ω–≥ (OpenTelemetry). 

---

### ‚úÖ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

#### üî∏ 1. –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–æ–≤ (OTEL Collector + Elasticsearch + Kibana)

- –í `deploy/compose/core/docker-compose.yml` –¥–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã:
  - `otel-collector` (–ø–æ—Å–ª–µ–¥–Ω–∏–π –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ `otel/opentelemetry-collector`)
  - `elasticsearch` –∏ `kibana` (–ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ –æ–±—Ä–∞–∑—ã 9.x)
- –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥ –∫–æ–ª–ª–µ–∫—Ç–æ—Ä–∞ `deploy/otel/collector.yaml` —Å –∫–æ–Ω–≤–µ–π–µ—Ä–æ–º –ª–æ–≥–æ–≤:
  - `receivers: otlp` (grpc: 4317, http: 4318)
  - `processors: batch` (–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ `resource` –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤)
  - `exporters: elasticsearch` (–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ ES, –∏–Ω–¥–µ–∫—Å –Ω–∞–ø—Ä–∏–º–µ—Ä `otel-logs-%{+yyyy.MM.dd}`)
  - `service.pipelines.logs`: `[otlp -> batch -> elasticsearch]`


---

#### üî∏ 2. –ü–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π –ª–æ–≥–µ—Ä: –¥–≤–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –≤—ã–≤–æ–¥–∞ (stdout + OTEL Collector)

- –í `/platform/pkg/logger`:
  - –†–∞—Å—à–∏—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥ –ª–æ–≥–µ—Ä–∞, –¥–æ–±–∞–≤–∏–≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤—ã—Ö–æ–¥–æ–≤:
    - `LOG_OUTPUTS` ‚Äî `stdout`, `otlp`.
    - `OTEL_COLLECTOR_ENDPOINT` ‚Äî –∞–¥—Ä–µ—Å OTLP/gRPC (–Ω–∞–ø—Ä–∏–º–µ—Ä `otel-collector:4317`)
    - `SERVICE_NAME`, `LOG_LEVEL`.
  - –°–æ–±—Ä–∞—Ç—å `zap.Logger` –∏–∑ –¥–≤—É—Ö `zapcore.Core`:
    - Core 1: JSON encoder ‚Üí stdout
    - Core 2: OTLP –ª–æ–≥-—ç–∫—Å–ø–æ—Ä—Ç–µ—Ä ‚Üí OTEL Collector (OTLP/gRPC)
  - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å API (`Info`, `Error`, –ø–æ–ª—è `zap`) –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞.
  - –î–æ–±–∞–≤–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π shutdown —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä–∞.

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (–∏–∑–º–µ–Ω–µ–Ω–∏—è):

---

#### üî∏ 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ª–æ–≥–µ—Ä–∞ –≤–æ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã

- –í–æ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö (`order`, `inventory`, `payment`, `assembly`, `notification`, `iam`):
  - –û–±–Ω–æ–≤–∏—Ç—å `internal/config/env/logger.go` (–∏–ª–∏ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç) ‚Äî –¥–æ–±–∞–≤–∏—Ç—å `OTEL_COLLECTOR_ENDPOINT`, `LOG_LEVEL`, `SERVICE_NAME`.
  - –í `internal/app/di.go` –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–µ—Ä –∏–∑ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –∏ –ø—Ä–æ–∫–∏–Ω—É—Ç—å —á–µ—Ä–µ–∑ DI –≤–æ –≤—Å–µ —Å–ª–æ–∏ (`api`, `service`, `consumer`, `producer`, `repository`, `client`).
  - –£–¥–∞–ª–∏—Ç—å –æ–±—Ö–æ–¥–Ω—ã–µ –ª–æ–≥–µ—Ä—ã/–≤—ã–∑–æ–≤—ã, –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π –ª–æ–≥–µ—Ä.
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ª–æ–≥–∏ –≤–∏–¥–Ω—ã –≤ stdout, –ø–æ–ø–∞–¥–∞—é—Ç –≤ Elasticsearch –∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ Kibana.

---

#### üî∏ 4. –ú–µ—Ç—Ä–∏–∫–∏ (Prometheus + Grafana)

- –ü–æ–¥–Ω—è—Ç—å/–ø–æ–¥–∫–ª—é—á–∏—Ç—å **Prometheus** –≤ `deploy/compose/core/docker-compose.yml`.
- –í `OrderService` –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏:
  - `orders_total` ‚Äî —Å—á—ë—Ç—á–∏–∫ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
  - `orders_revenue_total` ‚Äî —Å—É–º–º–∞—Ä–Ω–∞—è –≤—ã—Ä—É—á–∫–∞ (Counter/CounterVec –ø–æ –≤–∞–ª—é—Ç–µ ‚Äî –ø–æ –∂–µ–ª–∞–Ω–∏—é)
- –í `AssemblyService` –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫—É:
  - `assembly_duration_seconds` ‚Äî –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–±–æ—Ä–∫–∏
- –ü–æ–¥–Ω—è—Ç—å **Grafana**, –ø–æ–¥–∫–ª—é—á–∏—Ç—å Prometheus –∏ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ.

---

#### üî∏ 5. –¢—Ä–µ–π—Å–∏–Ω–≥ (Distributed Tracing)

- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å **OpenTelemetry Tracing** –≤ `OrderService` –∏ `PaymentService`.
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π —Ç—Ä–µ–π—Å —Å—Ü–µ–Ω–∞—Ä–∏—è –æ–ø–ª–∞—Ç—ã:
  - –ü—Ä–∏ `PayOrder` —Å–æ–∑–¥–∞—Ç—å root span –≤ `OrderService`.
  - –ü—Ä–æ–±—Ä–æ—Å–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ `PaymentService` (gRPC metadata) –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ç—Ä–µ–π—Å.
  - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤ —Ç—Ä–µ–π—Å-UI –≤–∏–¥–Ω–æ —Ü–µ–ø–æ—á–∫—É: `HTTP ‚Üí OrderService ‚Üí gRPC ‚Üí PaymentService`.
- –≠–∫—Å–ø–æ—Ä—Ç —Ç—Ä–µ–π—Å–æ–≤ —á–µ—Ä–µ–∑ OTLP –≤ OTEL Collector; –¥–∞–ª–µ–µ –≤ Jaeger.

---

## üí° –ü–æ–ª–µ–∑–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏

- –î–µ—Ä–∂–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤ —Å—Ç—Ä–æ–≥–æ JSON –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞.
- –î–ª—è –æ–±–æ–≥–∞—â–µ–Ω–∏—è –ø–æ–ª–µ–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `zap.Field` –∏/–∏–ª–∏ `resource` –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –≤ –∫–æ–ª–ª–µ–∫—Ç–æ—Ä–µ.
- –í Kibana –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω–¥–µ–∫—Å `otel-logs-*`.

---

**–ê–≤—Ç–æ—Ä –∫—É—Ä—Å–∞: –û–ª–µ–≥ –ö–æ–∑—ã—Ä–µ–≤, 2025**
